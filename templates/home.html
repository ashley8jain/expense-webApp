{% extends 'layout.html' %}

{% block container %}
  <!-- <h1>Expense List</h1>
  <ul class="list-group">
    {% for data in datas %}
      <li class="list-group-item">{{data.info}}</li>
    {% endfor %}
  </ul> -->

  <h1> Dashboard </h1>
  <hr>
  <div class="row">
    <div class="col-xs-4">
      <select id="filter_category" name="filter_category" onchange="categoryFilter()" class="form-control">
        <option value="all">All</option>
        <option value="Grocery">Grocery</option>
        <option value="Entertainment">Entertainment</option>
        <option value="Vehicle">Vehicle</option>
        <option value="Food">Food</option>
        <option value="miscellaneous">miscellaneous</option>
      </select>
    </div>
    <div class="col-xs-6">
      <div class="input-group">
        <input type="date" id="datefield" class="form-control" name="start" />
        <span class="input-group-addon">to</span>
        <input type="date" id="datefield2" class="form-control" name="end" />
      </div>
    </div>
    <div class="col-xs-2">
      <button onclick="dateFilter()" type="button" class="btn btn-primary">Show</button>
    </div>
  </div>
  <h3> Expense List </h3>
  <br>
  <input class="form-control" id="myInput" onkeyup="filterTable()" type="text" placeholder="Search...">
  <table class="table">
    <thead>
      <tr>
        <th>ID</th>
        <th>Info</th>
        <th>Category</th>
        <th>Amount</th>
        <th>Date</th>
        <th></th>
        <th></th>
      </tr>
    </thead>
    <tbody id="expenseTable">
      {% for data in datas %}
        <tr bgcolor={{color[data.category]}}>
          <td>{{data.id}}</td>
          <td>{{data.info}}</td>
          <td class="catg">{{category[data.category]}}</td>
          <td>{{data.amount}}</td>
          <td class="datee">{{data.date_created}}</td>
          <td><a href="edit_expense/{{data.id}}" class="btn btn-default pull-right">Edit</a></td>
          <td>
            <form method="POST" action="{{url_for('delete_expense', id=data.id)}}" >
              <input type="hidden" name="_method" value="DELETE">
              <input type="submit" value="Delete" class="btn btn-danger">
            </form>
          </td>
        </tr>
      {% endfor %}
    </tbody>
  </table>
  <a class="btn btn-success" href="/add_expense"> Add Expense</a>
{% endblock %}

{% block script %}

  var today = new Date();
  var dd = today.getDate();
  var mm = today.getMonth()+1; //January is 0!
  var yyyy = today.getFullYear();
  if(dd<10){
    dd='0'+dd
  }
  if(mm<10){
    mm='0'+mm
  }
  today = yyyy+'-'+mm+'-'+dd;
  document.getElementById("datefield").setAttribute("max", today);
  document.getElementById("datefield2").setAttribute("max", today);

  function filterTable(){
    var value = $("#myInput").val().toLowerCase();
    $("#expenseTable tr").filter(function() {
      $(this).toggle($(this).text().toLowerCase().indexOf(value) > -1)
    });
  }

  function categoryFilter(){
      var value = $("#filter_category").val();
      if(value=="all"){
        $("#expenseTable tr").show();
      }
      else{
        $("#expenseTable tr").filter(function() {
          $(this).toggle($(this).children('td.catg').text().indexOf(value) > -1)
        });
      }
  }

  function dateFilter() {
    if( $("#datefield").val().length != 0 && $("#datefield2").val().length != 0){

      var startDt = Date.parse($("#datefield").val())
      var endDt = Date.parse($("#datefield2").val())

      if(startDt <= endDt){
        $("#expenseTable tr").filter(function() {
          var datee = Date.parse($(this).children('td.datee').text())
          $(this).toggle(datee>=Date.parse($("#datefield").val()) && datee<=Date.parse($("#datefield2").val()))
        });
      }
      else{
        alert("Start date should be before end date !!!")
      }
    }
    else{
      $("#expenseTable tr").show();
    }
  }


{% endblock %}
